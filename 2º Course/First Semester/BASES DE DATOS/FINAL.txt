--2
SELECT SEXO,MAX(TIEMPOVUELTARAPIDA) VUELTA_MENOS_RAPIDA
FROM CARRERAPILOTO C, PILOTO P
WHERE P.CODPILOTO = C.CODPILOTO
GROUP BY P.SEXO;


--3
SELECT PA.NOMBRE_ESP, E.EQUIPO, T.ANO, COUNT(PI.CODPILOTO) PILOTS
FROM EQUIPO E, TEMPORADA T, PAIS PA, PILOTO PI, PILOTOEQUIPO PE
WHERE PA.CODPAIS = E.CODPAIS AND E.EQUIPO = PE.EQUIPO AND PE.CODPILOTO = PI.CODPILOTO AND PA.CODPAIS = PI.CODPAIS AND PE.ANO = T.ANO
GROUP BY E.EQUIPO, T.ANO, PA.NOMBRE_ESP;

--4
SELECT P.NOMBRE, COUNT(CP.FECHACARRERA) PODIOS
FROM PILOTO P, CARRERAPILOTO CP
WHERE P.CODPILOTO = CP.CODPILOTO AND POSICION_LLEGADA <= 2
GROUP BY P.NOMBRE
HAVING COUNT(CP.FECHACARRERA) <= 3;

--5
SELECT CIR.CIRCUITO, CP.FECHACARRERA, PA.NOMBRE_ENG, PI.NOMBRE, CP.POSICION_LLEGADA
FROM CIRCUITO CIR, CARRERAPILOTO CP, PAIS PA, PILOTO PI, CARRERA C
WHERE PA.CODPAIS = CIR.CODPAIS AND CIR.CIRCUITO = C.CIRCUITO AND C.FECHACARRERA = CP.FECHACARRERA AND CP.CODPILOTO = PI.CODPILOTO AND CP.POSICION_LLEGADA <= 3
ORDER BY CP.POSICION_LLEGADA DESC;

--6
SELECT DISTINCT PI.NOMBRE, PA.NOMBRE_ENG Pais_Corredor, E.EQUIPO, PA.NOMBRE_ENG Pais_Equipo
FROM PILOTO PI, PAIS PA, EQUIPO E, PILOTOEQUIPO PE
WHERE PA.CODPAIS = PI.CODPAIS AND PI.CODPILOTO = PE.CODPILOTO AND PE.EQUIPO = E.EQUIPO
ORDER BY Pais_Equipo ASC, Pais_Corredor DESC;

--7
CREATE TABLE CIRCUITO_HISTORICO (
    COD_CIR_HIS VARCHAR(10) NOT NULL,
    CIRCUITO VARCHAR2(50) NOT NULL, 
    LONGITUD NUMBER NOT NULL, 
    VUELTAS NUMBER NOT NULL, 
    CIUDAD VARCHAR2(50) NOT NULL, 
    CODPAIS CHAR(2) NOT NULL, 
    URBANO VARCHAR2(4) NOT NULL, 
    FECHA_CREACION DATE NOT NULL,
    CONSTRAINT URBANO_CHKE CHECK (URBANO IN ('S', 'N', 'SEMI')),
    CONSTRAINT CIRCUITO_PAIS_FKE FOREIGN KEY (CODPAIS) REFERENCES PAIS (CODPAIS),
    CONSTRAINT PK_CH PRIMARY KEY (COD_CIR_HIS)
);
INSERT INTO CIRCUITO_HISTORICO (COD_CIR_HIS, CIRCUITO, LONGITUD, VUELTAS, CIUDAD, CODPAIS, URBANO, FECHA_CREACION) VALUES ('C1','Albert Park', 5300, 70, 'PAMPLONA', 'AU', 'SEMI','30/11/2021');
INSERT INTO CIRCUITO_HISTORICO (COD_CIR_HIS, CIRCUITO, LONGITUD, VUELTAS, CIUDAD, CODPAIS, URBANO, FECHA_CREACION) VALUES ('C2','Albert Park', 5300, 70, 'HOLA', 'AU', 'SEMI','30/11/2021');
DELETE FROM CIRCUITO_HISTORICO WHERE CIUDAD = 'HOLA';



--8
INSERT INTO CIRCUITO_HISTORICO (COD_CIR_HIS, CIRCUITO, LONGITUD, VUELTAS, CIUDAD, CODPAIS, URBANO, FECHA_CREACION) VALUES ('C3','Albert Park', 5300, 70, 'PAMPLONA', 'AU', 'S','30/11/2021');
INSERT INTO CIRCUITO_HISTORICO (COD_CIR_HIS, CIRCUITO, LONGITUD, VUELTAS, CIUDAD, CODPAIS, URBANO, FECHA_CREACION) VALUES ('C4','Albert Park', 5300, 70, 'PAMPLONA', 'AU', 'N','30/11/2021');
INSERT INTO CIRCUITO_HISTORICO (COD_CIR_HIS, CIRCUITO, LONGITUD, VUELTAS, CIUDAD, CODPAIS, URBANO, FECHA_CREACION) VALUES ('C5','Albert Park', 5300, 70, 'PAMPLONA', 'AU', 'SEMI','30/11/2021');
ALTER TABLE CIRCUITO_HISTORICO DROP CONSTRAINT URBANO_CHKE;
ALTER TABLE CIRCUITO_HISTORICO MODIFY URBANO VARCHAR2(5);
UPDATE CIRCUITO_HISTORICO SET URBANO = 'YES' WHERE URBANO = 'S';
UPDATE CIRCUITO_HISTORICO SET URBANO = 'NO' WHERE URBANO = 'N';
UPDATE CIRCUITO_HISTORICO SET URBANO = 'MIXTO' WHERE URBANO = 'SEMI';
ALTER TABLE CIRCUITO_HISTORICO ADD CONSTRAINT URBANO_CHKENUEVO CHECK (URBANO IN ('YES', 'NO', 'MIXTO'));
DROP TABLE CIRCUITO_HISTORICO;


--9
SELECT COUNT(*)/COUNT(DISTINCT ANO)
FROM CARRERA;

SELECT ANO,NUMEROCARRERAS
FROM TEMPORADA;

UPDATE TEMPORADA SET NUMEROCARRERAS = 3 WHERE ANO = 2019;















SELECT SEXO,MAX(TIEMPOVUELTARAPIDA) VUELTA_MENOS_RAPIDA
FROM CARRERAPILOTO C, PILOTO P
WHERE P.CODPILOTO = C.CODPILOTO
GROUP BY P.SEXO
ORDER BY VUELTA_MENOS_RAPIDA ASC;



SELECT DISTINCT PA.NOMBRE_ESP, E.EQUIPO, T.ANO, COUNT(PE.CODPILOTO) PILOTS
FROM EQUIPO E, TEMPORADA T, PAIS PA, PILOTOEQUIPO PE
WHERE PA.CODPAIS = E.CODPAIS AND E.EQUIPO = PE.EQUIPO AND  PE.ANO = T.ANO
GROUP BY E.EQUIPO, T.ANO, PA.NOMBRE_ESP;


SELECT P.NOMBRE, COUNT(CP.FECHACARRERA) PODIOS
FROM PILOTO P, CARRERAPILOTO CP
WHERE P.CODPILOTO = CP.CODPILOTO AND POSICION_LLEGADA <= 2
GROUP BY P.NOMBRE
HAVING COUNT(CP.FECHACARRERA) <= 3;


SELECT CIR.CIRCUITO, CP.FECHACARRERA, PA.NOMBRE_ENG, PI.NOMBRE, CP.POSICION_LLEGADA
FROM CIRCUITO CIR, CARRERAPILOTO CP, PAIS PA, PILOTO PI, CARRERA C
WHERE PA.CODPAIS = CIR.CODPAIS AND CIR.CIRCUITO = C.CIRCUITO AND C.FECHACARRERA = CP.FECHACARRERA AND CP.CODPILOTO = PI.CODPILOTO AND CP.POSICION_LLEGADA <= 3
ORDER BY CP.POSICION_LLEGADA DESC;



SELECT DISTINCT PI.NOMBRE, PI.LUGARNACIMIENTO Pais_Corredor, E.EQUIPO, PA.NOMBRE_ENG Pais_Equipo
FROM PILOTO PI, PAIS PA, EQUIPO E, PILOTOEQUIPO PE
WHERE PA.CODPAIS = PI.CODPAIS AND PI.CODPILOTO = PE.CODPILOTO AND PE.EQUIPO = E.EQUIPO
ORDER BY Pais_Equipo ASC, Pais_Corredor DESC;

CREATE TABLE CIRCUITO_HISTORICO (
    COD_CIR_HIS VARCHAR(10) NOT NULL,
    CIRCUITO VARCHAR2(50) NOT NULL,
    LONGITUD NUMBER NOT NULL,
    VUELTAS NUMBER NOT NULL,
    CIUDAD VARCHAR2(50) NOT NULL,
    CODPAIS CHAR(2) NOT NULL,
    URBANO VARCHAR2(4) NOT NULL,
    FECHA_CREACION DATE NOT NULL,
    CONSTRAINT URBANO_CHKE CHECK (URBANO IN ('S', 'N', 'SEMI')),
    CONSTRAINT CIRCUITO_PAIS_FKE FOREIGN KEY (CODPAIS) REFERENCES PAIS (CODPAIS),
    CONSTRAINT PK_CH PRIMARY KEY (COD_CIR_HIS)
);
INSERT INTO CIRCUITO_HISTORICO (COD_CIR_HIS, CIRCUITO, LONGITUD, VUELTAS, CIUDAD, CODPAIS, URBANO, FECHA_CREACION) VALUES ('C1','Albert Park', 5300, 70, 'PAMPLONA', 'AU', 'SEMI','30/11/2021');
INSERT INTO CIRCUITO_HISTORICO (COD_CIR_HIS, CIRCUITO, LONGITUD, VUELTAS, CIUDAD, CODPAIS, URBANO, FECHA_CREACION) VALUES ('C2','Albert Park', 5300, 70, 'HOLA', 'AU', 'SEMI','30/11/2021');
SELECT * FROM CIRCUITO_HISTORICO;
DELETE FROM CIRCUITO_HISTORICO WHERE CIUDAD = 'HOLA';

